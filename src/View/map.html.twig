
<div id="container_allow">
    <p id="title_allow">Server want to know your location</p>
    <div id="container_btns">
        <input id="btn_yes" type="button" value="Yes">
        <input id="btn_no" type="button" value="No">
    </div>
</div>

<h2 id="current_location"></h2>

<div id="container_verif" style="display: none;">
    <label for="verif">Is not your location ? Tape it :</label>
    <input name="verif" type="text" id="verf_location">
    <input id="btn_verfloc" type="button" value="validate">
</div>

<div id="container_maps" style="height-min: 100px">

</div>

<div id="map"></div>

<style>
    #map{
        height: 400px;
        width: 600px;
    }
</style>

<script src="https://maps.google.com/maps/api/js?key=AIzaSyAL6h6k3hrV_vnjVYTU-uQ-yc-t0LMNQ0s" type="text/javascript"></script>
<script async type="text/javascript">
    let map;

    document.getElementById('btn_yes').addEventListener('click', ()=>{
        if(navigator.geolocation){
            navigator.geolocation.getCurrentPosition(showPosition);
            navigator.geolocation.getCurrentPosition(showMapsPosition);
            document.getElementById('container_allow').style.display = 'none';
            document.getElementById('container_verif').style.removeProperty('display');
        } else{
            document.getElementById('current_location').innerHTML = "Geolocation is not supported by this browser";
        }
    });

    document.getElementById('btn_verfloc').addEventListener('click', ()=>{
        let loc = document.getElementById('verf_location');
        if(loc.value != null){
            showPositionText(loc.value);
            showMapsPositionText(loc.value);
        }
    });




    function showPosition(loc){
        document.getElementById('current_location').innerHTML = "Latitude: " + loc.coords.latitude +
            "<br>Longitude: " + loc.coords.longitude;
    }
    function showPositionText(loc){
        document.getElementById('current_location').innerHTML = "Your location : " + loc;
    }
    function showMapsPosition(loc){
        initMap(loc.coords);
        //document.getElementById('container_maps').innerHTML = `<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2634.1491966864232!2d6.159434816071671!3d48.683512079270706!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4794a283532d81a9%3A0xd8601e71c5802628!2sInstitut%20Universitaire%20de%20Technologie%20Nancy-Charlemagne!5e0!3m2!1sfr!2sfr!4v1632821412168!5m2!1sfr!2sfr" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
    }
    function showMapsPositionText(loc){
        let geocoder = new google.maps.Geocoder();

        let location = codeAdress(loc, geocoder);
        initMap(location);


        //document.getElementById('container_maps').innerHTML = `<iframe id="maps" src="https://www.google.com/maps/embed?pb=" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
        //document.getElementById('maps').src += loc.replaceAll(' ', '+');
    }

    function initMap(location){
        map = new google.maps.Map(document.getElementById('map'), {
            center : {lat: location.latitude, lng: location.longitude},
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            zoom : 12
        })
    }
    function reloadMapText(lat, lng){
        map = new google.maps.Map(document.getElementById('container_maps'), {
            center : new google.maps.LatLng(lat, lng),

            zoom : 12
        })
    }


    function codeAdress(addr, geocoder){
        geocoder.geocode( { 'address': addr}, function(results, status) {
            if (status == 'OK') {
                return results[0].geometry.location;
                /*map.setCenter(results[0].geometry.location);
                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location
                });*/
            } else {
                alert('Geocode was not successful for the following reason: ' + status);
                return null;
            }
        });
    }
</script>